{% extends 'dreams/base.html' %}
{% block title %}夢境詳細管理{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="card shadow-lg rounded-5 border-0">
    <div class="card-header bg-gradient-primary text-white d-flex justify-content-between align-items-center px-5 py-4 rounded-top-5">
      <h3 class="mb-0 fw-bold">夢境詳細管理 <small class="opacity-75">編號 #{{ dream.id }}</small></h3>
      <a href="{% url 'manage_dreams' %}" class="btn btn-outline-light btn-sm shadow-sm fw-semibold">返回列表</a>
    </div>
    <div class="card-body px-5 py-4">

      <section class="mb-5">
        <h5 class="text-secondary fw-semibold mb-3">使用者</h5>
        <p class="fs-5 text-dark">{{ dream.user.username }}</p>
        <hr>
      </section>

      <section class="mb-5">
        <h5 class="text-secondary fw-semibold mb-3">夢境內容</h5>
        <div class="p-4 bg-white rounded-4 shadow-sm border border-primary-subtle" style="white-space: pre-wrap; line-height: 1.7; font-size: 1.05rem; color: #212529;">
          {{ dream.dream_content|default:"(無內容)" }}
        </div>
        <hr class="mt-4">
      </section>

      <section class="mb-5">
        <h5 class="text-secondary fw-semibold mb-3">解析結果</h5>
        <div class="p-4 bg-warning bg-opacity-25 rounded-4 shadow-sm border border-warning-subtle" style="white-space: pre-wrap; line-height: 1.7; font-size: 1.05rem; color: #664d03;">
          {{ dream.interpretation|default:"(無解析)" }}
        </div>
        <hr class="mt-4">
      </section>

      <section class="mb-5">
        <h5 class="text-secondary fw-semibold mb-3">情緒指數</h5>
        <div class="row g-4">
          {% for label, value, color, icon in emotion_data %}
          <div class="col-6 col-md-4 col-lg-2 d-flex flex-column align-items-center text-center">
            <div class="position-relative mb-2" style="width: 96px; height: 96px;">
              <svg viewBox="0 0 36 36" class="circular-chart" aria-label="{{ label }}百分比">
                <path class="circle-bg" d="M18 2.0845
                    a 15.9155 15.9155 0 0 1 0 31.831
                    a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e9ecef" stroke-width="3.5" />
                <path class="circle" stroke="var(--bs-{{ color }})" stroke-width="3.5" stroke-linecap="round"
                      fill="none" stroke-dasharray="{{ value }}, 100"
                      d="M18 2.0845
                          a 15.9155 15.9155 0 0 1 0 31.831
                          a 15.9155 15.9155 0 0 1 0 -31.831" />
                <text x="18" y="20.35" class="percentage" text-anchor="middle" fill="var(--bs-{{ color }})"
                      font-size="7" font-weight="700">{{ value|floatformat:1 }}%</text>
              </svg>
              <i class="fas fa-{{ icon }} position-absolute top-50 start-50 translate-middle fs-3 text-{{ color }}"></i>
            </div>
            <div class="fw-semibold text-dark fs-6">{{ label }}</div>
          </div>
          {% endfor %}
        </div>
      </section>

      <section class="mb-5">
        <h5 class="text-secondary fw-semibold mb-3">建立時間</h5>
        <p class="fs-6 text-muted">{{ dream.created_at|date:"Y-m-d H:i" }}</p>
      </section>

      <form method="post" onsubmit="return confirm('確定刪除此夢境？此操作無法復原！');" class="d-flex gap-3">
        {% csrf_token %}
        <button type="submit" name="delete" class="btn btn-danger flex-grow-1 py-3 fw-semibold shadow-sm btn-lg">刪除夢境</button>
        <a href="{% url 'manage_dreams' %}" class="btn btn-outline-secondary flex-grow-1 py-3 fw-semibold btn-lg">取消</a>
      </form>
    </div>
  </div>
</div>

<style>
.circular-chart {
  display: block;
  margin: 0 auto;
  max-width: 96px;
  max-height: 96px;
  transform: rotate(-90deg);
}
.circle-bg {
  stroke: #e9ecef;
}
.circle {
  transition: stroke-dasharray 0.7s ease 0s;
}
.percentage {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  dominant-baseline: middle;
  transform: rotate(90deg);
}
</style>
{% endblock %}
