<!-- 編輯使用者資料 -->
{% extends 'dreams/base.html' %}
{% block title %}使用者詳情編輯{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="card shadow rounded-4">
    <div class="card-header bg-dark text-white">
      <h4 class="mb-0"><i class="fas fa-user-edit me-2"></i>編輯使用者資料</h4>
    </div>
    <div class="card-body">
      <form method="post" action="{% url 'view_user_detail' user.id %}">
        {% csrf_token %}
        
        <div class="mb-3">
          <label for="username" class="form-label"><strong>帳號 (Username)</strong></label>
          <input type="text" class="form-control" id="username" name="username" 
            value="{% with name=user.username %}{% if name|length > 1 %}{{ name|slice:":1" }}＊{{ name|slice:"2:" }}{% else %}{{ name }}{% endif %}{% endwith %}" 
            readonly>
        </div>


        <div class="mb-3">
          <label for="role" class="form-label"><strong>身分 (Role)</strong></label>
          <select name="role" id="role" class="form-select">
            <option value="therapist" {% if user.userprofile.is_therapist and not user.userprofile.is_verified_therapist %}selected{% endif %}>未認證心理師</option>
            <option value="verified" {% if user.userprofile.is_verified_therapist %}selected{% endif %}>認證心理師</option>
            <option value="user" {% if not user.userprofile.is_therapist and not user.is_superuser %}selected{% endif %}>一般使用者</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="points" class="form-label"><strong>點數</strong></label>
          <input type="number" class="form-control" id="points" name="points" value="{{ profile_form.instance.points|default:0 }}">
        </div>

        <div class="mb-3 form-check">
          <input class="form-check-input" type="checkbox" id="is_active" name="is_active" {% if user.is_active %}checked{% endif %}>
          <label class="form-check-label" for="is_active"><strong>啟用帳號</strong></label>
        </div>
        
        <div class="mb-3">
          <label class="form-label"><strong>最後登入</strong></label>
            <input type="text" class="form-control" value="{{ user.last_login|date:'Y-m-d H:i' }}" readonly>
        </div>

        <div class="mb-3">
          <label class="form-label"><strong>加入時間</strong></label>
          <input type="text" class="form-control" value="{{ user.date_joined|date:'Y-m-d H:i' }}" readonly>
        </div>

        <div class="d-flex justify-content-end">
          <a href="{% url 'manage_users' %}" class="btn btn-secondary me-2">返回列表</a>
          <button type="submit" class="btn btn-primary">儲存修改</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
